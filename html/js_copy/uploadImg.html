<!doctype html public "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="Keywords" content="YES!B/S!" /> 
<meta name="Description" content="This page is from http://Justinyoung.cnblogs.com" /> 
<title>CSS/Javascript demo</title> 
</head> 
<body> 
	<input type="file" id="upload" name="upload">
	<div id="holder"></div>
	<script type="text/javascript">
		// ----------------------
		upload.addEventListener('change', function (e) {
			// 方法一
			// var image = new Image();
			// image.crossOrigin = '';
			// image.src = e.target.baseURI;
			// image.onload = function(){
			// 	var base64 = getBase64Image(image);
			// 	console.log(base64);
			// }

			// 方法二
			var f = new FileReader();
			f.readAsArrayBuffer(upload.files[0]);
			f.onload = function (e) {
				var file = new File([f.result],'default.jpg');
				var reader = new FileReader();
				reader.onload = function (event) {
				    var image = new Image();
				    image.src = event.target.result;
				    image.width = 250; // a fake resize
				    holder.appendChild(image);
				};

				reader.readAsDataURL(file);
			};
		});

		// function getBase64Image(img) {
		//     var canvas = document.createElement("canvas");
		//     canvas.width = img.width;
		//     canvas.height = img.height;
		 
		//     var ctx = canvas.getContext("2d");
		//     ctx.drawImage(img, 0, 0, img.width, img.height);
		//     var ext = img.src.substring(img.src.lastIndexOf(".")+1).toLowerCase();
		//     var dataURL = canvas.toDataURL("image/"+ext);
		//     return dataURL;
		// }
	</script>
</body> 
</html> 